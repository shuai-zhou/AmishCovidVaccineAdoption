--------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  F:\OneDrive - The Pennsylvania State University\Academic\Publication_Sub\AmishCovid202212\results/s4.2_
> calculate_r2.log
  log type:  text
 opened on:  28 Dec 2022, 22:18:55

. 
. *==========================================================
. * IMPORTANT TOTURIALS
. *==========================================================
. // https://www.stata.com/support/faqs/statistics/r-squared/
. // https://www.statalist.org/forums/forum/general-stata-discussion/general/1498454-r-squared-negative-binomial
. // https://www.statalist.org/forums/forum/general-stata-discussion/general/1638780-r2-for-xtnbreg-model
. // https://stats.oarc.ucla.edu/stata/dae/negative-binomial-regression/
. // https://www.statalist.org/forums/forum/general-stata-discussion/general/1351824-calculating-r2-with-xtpoisson
. 
. *==========================================================
. * macro IVs
. *==========================================================
. local ivs amishpct evang_no_amish trump2020

. 
. *==========================================================
. * monthly model: all counties
. *==========================================================
. use "$data/resdata_monthly.dta", clear

. xtset countynum monthly
       panel variable:  countynum (strongly balanced)
        time variable:  monthly, 2021m2 to 2022m10
                delta:  1 month

. 
. xtnbreg mr `ivs' i.b1.met, pa vce(robust)

Iteration 1: tolerance = .73190083
Iteration 2: tolerance = .38424488
Iteration 3: tolerance = .12455991
Iteration 4: tolerance = .00821342
Iteration 5: tolerance = .01286505
Iteration 6: tolerance = .00055169
Iteration 7: tolerance = 3.110e-06
Iteration 8: tolerance = 1.405e-08

GEE population-averaged model                   Number of obs     =      7,497
Group variable:                  countynum      Number of groups  =        357
Link:                                  log      Obs per group:
Family:             negative binomial(k=1)                    min =         21
Correlation:                  exchangeable                    avg =       21.0
                                                              max =         21
                                                Wald chi2(4)      =     415.09
Scale parameter:                         1      Prob > chi2       =     0.0000

                                (Std. Err. adjusted for clustering on countynum)
--------------------------------------------------------------------------------
               |             Semirobust
            mr |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
      amishpct |  -.0136883   .0020214    -6.77   0.000    -.0176501   -.0097264
evang_no_amish |  -.0011909   .0006852    -1.74   0.082    -.0025339     .000152
     trump2020 |   -.012111   .0010011   -12.10   0.000    -.0140732   -.0101488
               |
           met |
    Non-metro  |    -.03215   .0184734    -1.74   0.082    -.0683573    .0040572
               |
         _cons |  -1.573335   .0596465   -26.38   0.000     -1.69024    -1.45643
--------------------------------------------------------------------------------

. vif, uncentered

    Variable |       VIF       1/VIF  
-------------+----------------------
    amishpct |      1.32    0.755463
evang_no_a~h |      3.19    0.313413
   trump2020 |      6.91    0.144752
       0.met |      4.37    0.228695
-------------+----------------------
    Mean VIF |      3.95

. predict mr_predict if e(sample)
(option mu assumed; Exponentiated linear prediction)

. corr mr mr_predict if e(sample)
(obs=7,497)

             |       mr mr_pre~t
-------------+------------------
          mr |   1.0000
  mr_predict |   0.1254   1.0000


. di r(rho) ^ 2
.01572689

. 
. 
end of do-file

. exit, clear
